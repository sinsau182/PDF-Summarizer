"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AssetLibrary = exports.ListAssetsRequest = exports.CreateAssetRequest = void 0;
const fs_1 = require("fs");
const client_s3_1 = require("@aws-sdk/client-s3");
const constants_1 = require("./constants");
const error_1 = require("./error");
/**
 * Request for creating an asset.
 *
 * @remarks
 * This is used with {@link AssetLibrary.create}.  The `data` field requires
 * data from the matching asset_type.  This includes {@link FileData},
 * {@link CheckpointData}, {@link LoraData}, {@link VAEData},
 * and {@link TextualInversionData}.
 */
class CreateAssetRequest {
    constructor(request) {
        this.asset_type = request.asset_type;
        this.data = request.data;
        this.name = request.name;
        this.description = request.description;
        const processedRequest = Object.keys(request).reduce((acc, key) => request[key] === undefined
            ? { ...acc }
            : { ...acc, [key]: request[key] }, {});
        Object.assign(this, processedRequest);
    }
}
exports.CreateAssetRequest = CreateAssetRequest;
class ListAssetsRequest {
    constructor(request) {
        const processedRequest = Object.keys(request).reduce((acc, key) => request[key] === undefined
            ? { ...acc }
            : { ...acc, [key]: request[key] }, {});
        Object.assign(this, processedRequest);
    }
}
exports.ListAssetsRequest = ListAssetsRequest;
/**
 * The AssetLibrary class.  Generally accessed through the client through
 * `client.asset`, but can be instantiated directly if a different endpoint is
 * desired.
 */
class AssetLibrary {
    constructor(client, endpoint) {
        this.client = client;
        if (!endpoint) {
            endpoint = `${this.client.secureLink ? constants_1.SECURELINK_BASE_API : constants_1.DEFAULT_BASE_API}/assets`;
        }
        this.endpoint = endpoint;
    }
    /**
     * Get a single asset.
     *
     * @param request - {@link GetAssetRequest} - includes either the name or the
     * id of the requested asset.
     *
     * @throws {@link OctoAIValidationError} - if no token was found when creating
     * the {@link Client} class, if neither an `id` nor `name` is provided, if both
     * are provided, or if the name or id provided is invalid.
     */
    async get(request) {
        if (this.client.headers.Authorization === "") {
            (0, error_1.throwOctoAITokenRequiredError)();
        }
        if (request.name === undefined && request.id === undefined) {
            throw new error_1.OctoAIValidationError("Either name or id must be provided.");
        }
        if (request.name !== undefined && request.id !== undefined) {
            throw new error_1.OctoAIValidationError("Only one of name or id may be provided.");
        }
        let nameOrId = "";
        if (request.name !== undefined) {
            nameOrId = request.name;
        }
        if (request.id !== undefined) {
            // To handle lint type checking, must be explicit
            nameOrId = request.id;
        }
        this.validateNameOrId(nameOrId);
        const response = await fetch(this.endpoint + `/${nameOrId}`, {
            method: "get",
            headers: this.client.headers,
        });
        if (!response.ok) {
            await (0, error_1.throwOctoAIError)(response);
        }
        const jsonAsset = await response.json();
        return jsonAsset.asset;
    }
    /**
     * List assets based on the search parameters provided.  Array of assets can be
     * accessed in response's `data` field.
     *
     * @remarks
     * This method is used with the {@link ListAssetsRequest} class to query
     * the assets and return.  If there are more assets, the {@link ListAssetsResponse}
     * will return `true` for has_more as well as the `total` number of assets.
     *
     * You can search by `name`, `data_type` such as "fp16", set a `limit`, or
     * start the next request at a certain `offset` for larger requests.
     *
     * An example of how to request octoai public assets is below:
     * ```
     *   const client = new Client(process.env.OCTOAI_TOKEN);
     *   const octoAssets = await client.asset.list({
     *     is_public: true,
     *     owner: "octoai",
     *     engine: "image/stable-diffusion-v1-5",
     *     asset_type: "lora",
     *   });
     * ```
     *
     * @param request - {@link ListAssetsRequest} - parameters to use to filter
     * assets in response.
     *
     * @throws {@link OctoAIValidationError} if there isn't a token set in the client.
     */
    async list(request) {
        if (this.client.headers.Authorization === "") {
            (0, error_1.throwOctoAITokenRequiredError)();
        }
        const processedRequest = new ListAssetsRequest(request);
        const reqURL = this.endpoint +
            "?" +
            new URLSearchParams(processedRequest);
        const response = await fetch(reqURL, {
            method: "GET",
            headers: this.client.headers,
        });
        if (!response.ok) {
            await (0, error_1.throwOctoAIError)(response);
        }
        const responseJSON = await response.json();
        return responseJSON;
    }
    /**
     * Delete an asset.
     *
     * @param id - ID of asset to be deleted.  Should start with `asset`.
     *
     * @throws {@link OctoAIValidationError} if no token was found when creating
     * the {@link Client} class or if id is invalid.
     */
    async delete(id) {
        if (this.client.headers.Authorization === "") {
            (0, error_1.throwOctoAITokenRequiredError)();
        }
        this.validateNameOrId(id);
        const response = await fetch(this.endpoint + `/${id}`, {
            method: "DELETE",
            headers: this.client.headers,
        });
        if (!response.ok) {
            await (0, error_1.throwOctoAIError)(response);
        }
        return (await response.json());
    }
    /**
     * Creates and uploads asset, then returns the {@link Asset}.
     *
     * Will select the most efficient transfer_api_type if left undefined.
     *
     * @param request - {@link CreateAssetRequest}
     *
     * @throws {@link OctoAIValidationError} if no token was found when creating
     * the {@link Client} class.
     *
     * @remarks
     * This is used with {@link CreateAssetRequest}.  The `data` field requires
     * data from the matching asset_type.  This includes {@link FileData},
     * {@link CheckpointData}, {@link LoraData}, {@link VAEData},
     * and {@link TextualInversionData}.
     *
     * @example
     * Creating an asset from a local file:
     * ```ts
     * import { Client, LoraData } from "@octoai/client";
     *
     * const client = new Client(process.env.OCTOAI_TOKEN);
     *
     * const loraData = {
     *   asset_type: "lora",
     *   data_type: "fp16",
     *   engine: "image/stable-diffusion-v1-5",
     *   file_format: "safetensors",
     *   trigger_words: ["origami paper"],
     * } as LoraData;
     *
     * const createdAsset = await client.asset.create({
     *   file: "./test_assets/origami-paper.safetensors",
     *   asset_type: "lora",
     *   description: "origami paper lora",
     *   data: loraData,
     *   name: "origami-paper",
     *   is_public: false,
     * });
     * ```
     *
     * @example
     * Creating an asset via URL upload:
     * ```ts
     * import { Client, LoraData } from "@octoai/client";
     *
     * const client = new Client(process.env.OCTOAI_TOKEN);
     *
     * const loraData = {
     *   asset_type: "lora",
     *   data_type: "fp16",
     *   engine: "image/stable-diffusion-xl-v1-0",
     *   file_format: "safetensors",
     *   trigger_words: ["my trigger word"],
     * } as LoraData;
     *
     * const createdAsset = await client.asset.create({
     *   url: "<ASSET_DOWNLOAD_URL>",
     *   asset_type: "lora",
     *   description: "My SDXL LoRA",
     *   data: loraData,
     *   name: "my-sdxl-lora",
     *   is_public: false,
     * });
     * ```
     */
    async create(request) {
        if (this.client.headers.Authorization === "") {
            (0, error_1.throwOctoAITokenRequiredError)();
        }
        if (!request.file && !request.url) {
            throw new error_1.OctoAIValidationError("Either 'file' or 'url' must be provided.");
        }
        if (request.file && request.url) {
            throw new error_1.OctoAIValidationError("Only one of 'file' or 'url' may be provided.");
        }
        if (request.file) {
            const blob = await this.getBuffer(request.file);
            // Pick most efficient option based on file size if not self-selected
            if (!request.transfer_api_type) {
                if (blob.byteLength >= 52428800) {
                    request.transfer_api_type = "sts";
                }
                else {
                    request.transfer_api_type = "presigned-url";
                }
            }
            // Drop all undefined fields.
            // eslint-disable-next-line @typescript-eslint/no-unused-vars -- I wanna omit via spread
            const { file, ...processedRequest } = new CreateAssetRequest(request);
            const { asset, transfer_api } = await this.createAsset(processedRequest);
            if (request.transfer_api_type === "sts") {
                await this.uploadSts(transfer_api, blob);
            }
            if (request.transfer_api_type === "presigned-url") {
                await this.uploadPresigned(transfer_api, blob);
            }
            await this.completeUpload(asset.id);
            return this.get({ id: asset.id });
        }
        else {
            if (!request.url || !URL.canParse(request.url)) {
                throw new error_1.OctoAIValidationError("A valid URL must be provided.");
            }
            // eslint-disable-next-line @typescript-eslint/no-unused-vars -- I wanna omit via spread again
            const { file, ...processedRequest } = new CreateAssetRequest(request);
            const { asset } = await this.createAsset(processedRequest);
            return this.get({ id: asset.id });
        }
    }
    /**
     * Waits for an {@link Asset} to be ready to use. Useful when uploading assets via URL.
     *
     * @param asset - The {@link Asset} to poll.
     * @param options - Additional options for changing the poll interval and timeout durations.
     * @returns A ready {@link Asset}.
     *
     * @throws {@link OctoAIValidationError}
     * Thrown if the asset has an upload error or if the asset is rejected for safety.
     *
     * @throws {@link OctoAITimeoutError}
     * Thrown if the asset isn't ready by the specified timeout. Doesn't
     * necessarily indicate a failure.
     */
    async waitForReady(asset, options) {
        const { pollIntervalMs = 10000, timeoutMs = 900000 } = options ?? {};
        let assetCopy = { ...asset };
        const startMs = new Date().getTime();
        do {
            await new Promise((resolve) => setTimeout(resolve, pollIntervalMs));
            assetCopy = await this.get({ id: asset.id });
            if (assetCopy.status === "ready") {
                return assetCopy;
            }
            if (assetCopy.status === "error" || assetCopy.status === "rejected") {
                throw new error_1.OctoAIValidationError(`Error validating asset ${assetCopy.id}: ${assetCopy.status} ${assetCopy.status_details}`);
            }
        } while (new Date().getTime() < startMs + timeoutMs);
        throw new error_1.OctoAITimeoutError(`Asset '${assetCopy.id}' was not ready after ${timeoutMs} milliseconds`);
    }
    // Returns buffer from provided valid files, else throws a validation error.
    /** @private */
    async getBuffer(file) {
        try {
            if (file instanceof ArrayBuffer) {
                return Buffer.from(file);
            }
            if (file instanceof Buffer) {
                return file;
            }
            // Try running as a file path instead
            return (0, fs_1.readFileSync)(file);
        }
        catch (e) {
            throw new error_1.OctoAIValidationError(`File ${file} was unable to be processed as an ArrayBuffer, Buffer, or a valid filepath.  Please verify the validity of your file and try again.`);
        }
    }
    async createAsset(request) {
        const response = await fetch(this.endpoint, {
            method: "POST",
            body: JSON.stringify(request),
            headers: this.client.headers,
        });
        if (!response.ok) {
            await (0, error_1.throwOctoAIError)(response);
        }
        return response.json();
    }
    // Posts the upload is done back to the API after file upload.
    // Used by create method.
    /** @private */
    async completeUpload(id) {
        const completionURL = this.endpoint + `/${id}/complete-upload`;
        const completeResponse = await fetch(completionURL, {
            method: "POST",
            body: JSON.stringify({}),
            headers: this.client.headers,
        });
        if (!completeResponse.ok) {
            await (0, error_1.throwOctoAIError)(completeResponse);
        }
    }
    // Uses the presigned API to upload a file.
    /** @private */
    async uploadPresigned(transferApi, blob) {
        const presignedResp = await fetch(transferApi.put_url, {
            method: "PUT",
            body: blob,
        });
        if (!presignedResp.ok) {
            throw new error_1.OctoAIServerError(`Error uploading file to server: ${presignedResp.statusText}`);
        }
    }
    // Uses the sts API to upload a file.
    /** @private */
    async uploadSts(transferApi, blob) {
        const s3 = new client_s3_1.S3({
            region: "us-east-1",
            credentials: {
                accessKeyId: transferApi.aws_access_key_id,
                secretAccessKey: transferApi.aws_secret_access_key,
                sessionToken: transferApi.aws_session_token,
            },
        });
        try {
            await s3.putObject({
                Bucket: transferApi.s3_bucket,
                Key: transferApi.s3_key,
                Body: blob,
            });
        }
        catch (e) {
            throw new error_1.OctoAIServerError(`Error uploading file to server: ${e}`);
        }
    }
    /** @private */
    validateNameOrId(nameOrId) {
        const regex = new RegExp("^[a-zA-Z0-9_-]*$");
        if (!regex.test(nameOrId)) {
            const msg = `name or id(${nameOrId}) is invalid.  Valid names or ids may only contain alphanumeric, '-', or '_' characters.`;
            throw new error_1.OctoAIValidationError(msg);
        }
    }
}
exports.AssetLibrary = AssetLibrary;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2Fzc2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDJCQUFrQztBQUVsQyxrREFBd0M7QUFnQnhDLDJDQUFvRTtBQUNwRSxtQ0FNaUI7QUFFakI7Ozs7Ozs7O0dBUUc7QUFDSCxNQUFhLGtCQUFrQjtJQXlDN0IsWUFBWSxPQUE0QjtRQUN0QyxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDckMsSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN6QixJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7UUFDdkMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FDbEQsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FDWCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUztZQUN4QixDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsRUFBRTtZQUNaLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQ3JDLEVBQUUsQ0FDSCxDQUFDO1FBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUN4QyxDQUFDO0NBQ0Y7QUF2REQsZ0RBdURDO0FBRUQsTUFBYSxpQkFBaUI7SUEwQzVCLFlBQVksT0FBNEI7UUFDdEMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FDbEQsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FDWCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUztZQUN4QixDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsRUFBRTtZQUNaLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQ3JDLEVBQUUsQ0FDSCxDQUFDO1FBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUN4QyxDQUFDO0NBQ0Y7QUFwREQsOENBb0RDO0FBcUJEOzs7O0dBSUc7QUFDSCxNQUFhLFlBQVk7SUFJdkIsWUFBWSxNQUFjLEVBQUUsUUFBaUI7UUFDM0MsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2QsUUFBUSxHQUFHLEdBQ1QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLCtCQUFtQixDQUFDLENBQUMsQ0FBQyw0QkFDakQsU0FBUyxDQUFDO1FBQ1osQ0FBQztRQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzNCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSSxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQXdCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQzdDLElBQUEscUNBQTZCLEdBQUUsQ0FBQztRQUNsQyxDQUFDO1FBQ0QsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLFNBQVMsSUFBSSxPQUFPLENBQUMsRUFBRSxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQzNELE1BQU0sSUFBSSw2QkFBcUIsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1FBQ3pFLENBQUM7UUFDRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssU0FBUyxJQUFJLE9BQU8sQ0FBQyxFQUFFLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDM0QsTUFBTSxJQUFJLDZCQUFxQixDQUM3Qix5Q0FBeUMsQ0FDMUMsQ0FBQztRQUNKLENBQUM7UUFDRCxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQy9CLFFBQVEsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQzFCLENBQUM7UUFDRCxJQUFJLE9BQU8sQ0FBQyxFQUFFLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDN0IsaURBQWlEO1lBQ2pELFFBQVEsR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ3hCLENBQUM7UUFDRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEMsTUFBTSxRQUFRLEdBQUcsTUFBTSxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxFQUFFO1lBQzNELE1BQU0sRUFBRSxLQUFLO1lBQ2IsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTztTQUM3QixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2pCLE1BQU0sSUFBQSx3QkFBZ0IsRUFBQyxRQUFRLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBQ0QsTUFBTSxTQUFTLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDeEMsT0FBTyxTQUFTLENBQUMsS0FBYyxDQUFDO0lBQ2xDLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BMkJHO0lBQ0ksS0FBSyxDQUFDLElBQUksQ0FBQyxPQUEwQjtRQUMxQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUM3QyxJQUFBLHFDQUE2QixHQUFFLENBQUM7UUFDbEMsQ0FBQztRQUNELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4RCxNQUFNLE1BQU0sR0FDVixJQUFJLENBQUMsUUFBUTtZQUNiLEdBQUc7WUFDSCxJQUFJLGVBQWUsQ0FBQyxnQkFBMEMsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sUUFBUSxHQUFHLE1BQU0sS0FBSyxDQUFDLE1BQU0sRUFBRTtZQUNuQyxNQUFNLEVBQUUsS0FBSztZQUNiLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87U0FDN0IsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNqQixNQUFNLElBQUEsd0JBQWdCLEVBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUNELE1BQU0sWUFBWSxHQUFHLE1BQU0sUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzNDLE9BQU8sWUFBa0MsQ0FBQztJQUM1QyxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBVTtRQUM1QixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUM3QyxJQUFBLHFDQUE2QixHQUFFLENBQUM7UUFDbEMsQ0FBQztRQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMxQixNQUFNLFFBQVEsR0FBRyxNQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksRUFBRSxFQUFFLEVBQUU7WUFDckQsTUFBTSxFQUFFLFFBQVE7WUFDaEIsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTztTQUM3QixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2pCLE1BQU0sSUFBQSx3QkFBZ0IsRUFBQyxRQUFRLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBQ0QsT0FBTyxDQUFDLE1BQU0sUUFBUSxDQUFDLElBQUksRUFBRSxDQUF3QixDQUFDO0lBQ3hELENBQUM7SUFDRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0FpRUc7SUFDSSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQTJCO1FBQzdDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQzdDLElBQUEscUNBQTZCLEdBQUUsQ0FBQztRQUNsQyxDQUFDO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDbEMsTUFBTSxJQUFJLDZCQUFxQixDQUM3QiwwQ0FBMEMsQ0FDM0MsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ2hDLE1BQU0sSUFBSSw2QkFBcUIsQ0FDN0IsOENBQThDLENBQy9DLENBQUM7UUFDSixDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDakIsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVoRCxxRUFBcUU7WUFDckUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUMvQixJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksUUFBUSxFQUFFLENBQUM7b0JBQ2hDLE9BQU8sQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7Z0JBQ3BDLENBQUM7cUJBQU0sQ0FBQztvQkFDTixPQUFPLENBQUMsaUJBQWlCLEdBQUcsZUFBZSxDQUFDO2dCQUM5QyxDQUFDO1lBQ0gsQ0FBQztZQUVELDZCQUE2QjtZQUM3Qix3RkFBd0Y7WUFDeEYsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLGdCQUFnQixFQUFFLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN0RSxNQUFNLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXpFLElBQUksT0FBTyxDQUFDLGlCQUFpQixLQUFLLEtBQUssRUFBRSxDQUFDO2dCQUN4QyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBOEIsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM3RCxDQUFDO1lBRUQsSUFBSSxPQUFPLENBQUMsaUJBQWlCLEtBQUssZUFBZSxFQUFFLENBQUM7Z0JBQ2xELE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FDeEIsWUFBdUMsRUFDdkMsSUFBSSxDQUNMLENBQUM7WUFDSixDQUFDO1lBRUQsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVwQyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDcEMsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQy9DLE1BQU0sSUFBSSw2QkFBcUIsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1lBQ25FLENBQUM7WUFFRCw4RkFBOEY7WUFDOUYsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLGdCQUFnQixFQUFFLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN0RSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFFM0QsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3BDLENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7T0FhRztJQUNILEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBWSxFQUFFLE9BQXdCO1FBQ3ZELE1BQU0sRUFBRSxjQUFjLEdBQUcsS0FBTSxFQUFFLFNBQVMsR0FBRyxNQUFPLEVBQUUsR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO1FBQ3ZFLElBQUksU0FBUyxHQUFVLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQztRQUNwQyxNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXJDLEdBQUcsQ0FBQztZQUNGLE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUVwRSxTQUFTLEdBQUcsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRTdDLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxPQUFPLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxTQUFTLENBQUM7WUFDbkIsQ0FBQztZQUVELElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxPQUFPLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxVQUFVLEVBQUUsQ0FBQztnQkFDcEUsTUFBTSxJQUFJLDZCQUFxQixDQUM3QiwwQkFBMEIsU0FBUyxDQUFDLEVBQUUsS0FBSyxTQUFTLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxjQUFjLEVBQUUsQ0FDMUYsQ0FBQztZQUNKLENBQUM7UUFDSCxDQUFDLFFBQVEsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxPQUFPLEdBQUcsU0FBUyxFQUFFO1FBRXJELE1BQU0sSUFBSSwwQkFBa0IsQ0FDMUIsVUFBVSxTQUFTLENBQUMsRUFBRSx5QkFBeUIsU0FBUyxlQUFlLENBQ3hFLENBQUM7SUFDSixDQUFDO0lBRUQsNEVBQTRFO0lBQzVFLGVBQWU7SUFDZixLQUFLLENBQUMsU0FBUyxDQUFDLElBQW1DO1FBQ2pELElBQUksQ0FBQztZQUNILElBQUksSUFBSSxZQUFZLFdBQVcsRUFBRSxDQUFDO2dCQUNoQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsQ0FBQztZQUNELElBQUksSUFBSSxZQUFZLE1BQU0sRUFBRSxDQUFDO2dCQUMzQixPQUFPLElBQUksQ0FBQztZQUNkLENBQUM7WUFDRCxxQ0FBcUM7WUFDckMsT0FBTyxJQUFBLGlCQUFZLEVBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsQ0FBQztRQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDWCxNQUFNLElBQUksNkJBQXFCLENBQzdCLFFBQVEsSUFBSSxxSUFBcUksQ0FDbEosQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRU8sS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUEyQjtRQUNuRCxNQUFNLFFBQVEsR0FBRyxNQUFNLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQzFDLE1BQU0sRUFBRSxNQUFNO1lBQ2QsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO1lBQzdCLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87U0FDN0IsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNqQixNQUFNLElBQUEsd0JBQWdCLEVBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUVELE9BQU8sUUFBUSxDQUFDLElBQUksRUFBa0MsQ0FBQztJQUN6RCxDQUFDO0lBRUQsOERBQThEO0lBQzlELHlCQUF5QjtJQUN6QixlQUFlO0lBQ2YsS0FBSyxDQUFDLGNBQWMsQ0FBQyxFQUFVO1FBQzdCLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxFQUFFLGtCQUFrQixDQUFDO1FBQy9ELE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxLQUFLLENBQUMsYUFBYSxFQUFFO1lBQ2xELE1BQU0sRUFBRSxNQUFNO1lBQ2QsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQ3hCLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87U0FDN0IsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3pCLE1BQU0sSUFBQSx3QkFBZ0IsRUFBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzNDLENBQUM7SUFDSCxDQUFDO0lBRUQsMkNBQTJDO0lBQzNDLGVBQWU7SUFDZixLQUFLLENBQUMsZUFBZSxDQUFDLFdBQW9DLEVBQUUsSUFBWTtRQUN0RSxNQUFNLGFBQWEsR0FBRyxNQUFNLEtBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFO1lBQ3JELE1BQU0sRUFBRSxLQUFLO1lBQ2IsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sSUFBSSx5QkFBaUIsQ0FDekIsbUNBQW1DLGFBQWEsQ0FBQyxVQUFVLEVBQUUsQ0FDOUQsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQscUNBQXFDO0lBQ3JDLGVBQWU7SUFDZixLQUFLLENBQUMsU0FBUyxDQUFDLFdBQTJCLEVBQUUsSUFBWTtRQUN2RCxNQUFNLEVBQUUsR0FBRyxJQUFJLGNBQUUsQ0FBQztZQUNoQixNQUFNLEVBQUUsV0FBVztZQUNuQixXQUFXLEVBQUU7Z0JBQ1gsV0FBVyxFQUFFLFdBQVcsQ0FBQyxpQkFBaUI7Z0JBQzFDLGVBQWUsRUFBRSxXQUFXLENBQUMscUJBQXFCO2dCQUNsRCxZQUFZLEVBQUUsV0FBVyxDQUFDLGlCQUEyQjthQUN0RDtTQUNGLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDakIsTUFBTSxFQUFFLFdBQVcsQ0FBQyxTQUFTO2dCQUM3QixHQUFHLEVBQUUsV0FBVyxDQUFDLE1BQU07Z0JBQ3ZCLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDWCxNQUFNLElBQUkseUJBQWlCLENBQUMsbUNBQW1DLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdEUsQ0FBQztJQUNILENBQUM7SUFDRCxlQUFlO0lBQ2YsZ0JBQWdCLENBQUMsUUFBZ0I7UUFDL0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQzFCLE1BQU0sR0FBRyxHQUFHLGNBQWMsUUFBUSwwRkFBMEYsQ0FBQztZQUM3SCxNQUFNLElBQUksNkJBQXFCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkMsQ0FBQztJQUNILENBQUM7Q0FDRjtBQWhZRCxvQ0FnWUMifQ==